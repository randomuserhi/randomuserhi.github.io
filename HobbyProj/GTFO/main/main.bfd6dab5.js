RHU.import(RHU.module({trace:new Error,name:"Report",hard:["RHU.Macro","RHU.Rest"],callback:function(){let{RHU:e}=window.RHU.require(window,this),t=new Map;{let e=new Image;e.src="./icons/general/checkpoint.png",t.set("checkpoint",e)}let i=function(){this.GTFOEnemyIcons=new Map,this.GTFOGearIcons=new Map,this.GTFOPackIcons=new Map,this.camera={zoom:1,x:0,y:0},this.selected=null,this.selectedEvents=[],this.timeline.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()})),this.ctx=this.timeline.getContext("2d"),window.addEventListener("resize",(()=>{this.render()})),this.render(),this.mouse={left:!1,right:!1,x:0,y:0};let t={x:0,y:0},i={x:0,y:0};this.timeline.addEventListener("mousedown",(e=>{if(e.preventDefault(),0===e.button)this.mouse.left=!0;else if(2===e.button){let e=(this.mouse.x+this.camera.x-this.timeline.width/2)*this.timePerPixel;this.selected={start:e,end:e},this.mouse.right=!0}i.x=this.mouse.x,i.y=this.mouse.y,t.x=this.mouse.x,t.y=this.mouse.y})),this.timeline.addEventListener("mousemove",(t=>{t.preventDefault();let s=this.timeline.getBoundingClientRect();if(this.mouse.x=t.clientX-s.left,this.mouse.y=t.clientY-s.top,this.mouse.left)this.camera.x+=i.x-this.mouse.x,i.x=this.mouse.x;else if(this.mouse.right&&e.exists(this.selected)){let e=(this.mouse.x+this.camera.x-this.timeline.width/2)*this.timePerPixel;this.selected.end=e}this.render()})),this.timeline.addEventListener("mouseup",(e=>{e.preventDefault(),0===e.button?(this.mouse.left=!1,this.mouse.x===t.x&&this.mouse.y===t.y&&(this.selected=null,this.render())):2===e.button&&(this.mouse.right=!1,this.mouse.x===t.x&&this.mouse.y===t.y&&(this.selected=null,this.render()))})),this.timeline.addEventListener("wheel",(e=>{if(this.mouse.y>this.timeline.height/2-100&&this.mouse.y<this.timeline.height/2+100){e.preventDefault();let t=this.camera.zoom;this.camera.zoom-=.002*e.deltaY,this.camera.zoom<.01&&(this.camera.zoom=.01);let i=this.mouse.x+this.camera.x-this.timeline.width/2,s=i/t*this.camera.zoom;this.camera.x+=s-i,this.render()}}))};i.prototype.render=function(){let i=getComputedStyle(this.timeline);if(this.timeline.width=parseInt(i.width),this.timeline.height=parseInt(i.height),0===this.timeline.width)return;let s=this.timeline.width,a=this.timeline.height,n=this.ctx;if(n.clearRect(0,0,s,a),e.exists(this.player)&&e.exists(this.report)){const i=100,l=6e5/this.camera.zoom,r=1;this.timePerPixel=l/s;const h=this.timePerPixel*r,m=Math.floor((this.camera.x-s/2)/r)*h,o=Math.ceil((this.camera.x+s/2)/r)*h;n.beginPath(),n.moveTo(0,a/2+i),n.lineTo(s,a/2+i),n.lineWidth=1,n.strokeStyle="#dadad1",n.stroke(),n.beginPath(),n.moveTo(0,a/2-i),n.lineTo(s,a/2-i),n.lineWidth=1,n.strokeStyle="#dadad1",n.stroke(),n.translate(0,a/2),n.save(),n.translate(s/2,0);let p=this.player.healthMax,c=0;{let e=this.player.healthTimeline,t=0;for(;t<e.length;++t)if(e[t].timestamp>m){t>0&&--t;break}let a=e[t],l=a.value/this.player.healthMax,r=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;r<this.mouse.x-s/2&&(p=a.value),n.beginPath();let c=i-2*i*l;for(n.moveTo(r,c),++t;t<e.length;++t){let a=e[t],l=a.value/this.player.healthMax,r=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;if(r<this.mouse.x-s/2&&(p=a.value),n.lineTo(r,c),c=i-2*i*l,n.lineTo(r,c),e[t].timestamp>o)break}n.lineWidth=1,n.strokeStyle="red",n.stroke()}if(this.player.infectionTimeline.filter((e=>0!=e.value)).length>0){let e=this.player.infectionTimeline,t=0;for(;t<e.length;++t)if(e[t].timestamp>m){t>0&&--t;break}let a=e[t],l=1-a.value,r=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;r<this.mouse.x-s/2&&(c=a.value),n.beginPath();let p=i-2*i*l;for(n.moveTo(r,p),++t;t<e.length;++t){let a=e[t],l=1-a.value,r=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;if(r<this.mouse.x-s/2&&(c=a.value),n.lineTo(r,p),p=i-2*i*l,n.lineTo(r,p),e[t].timestamp>o)break}n.lineWidth=1,n.strokeStyle="green",n.stroke()}{let e=this.player.stateTimeline,s=0;for(;s<e.length;++s)if(e[s].timestamp>m){s>0&&--s;break}for(;s<e.length;++s){let a=e[s],l=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;if("Checkpoint"!==a.type?(n.beginPath(),n.moveTo(l,-i-20),n.lineTo(l,i+20),n.lineWidth=1,n.strokeStyle="rgba(233, 188, 41, 1)",n.stroke()):(n.beginPath(),n.moveTo(l,-i-20),n.lineTo(l,i+20),n.lineWidth=1,n.strokeStyle="rgba(80, 212, 120, 0.5)",n.stroke(),t.has("checkpoint")&&n.drawImage(t.get("checkpoint"),l-25,-i-150,50,50)),e[s].timestamp>o)break}}{let t=this.player.damageTimeline,s=0;for(;s<t.length;++s)if(t[s].timestamp>m){s>0&&--s;break}for(;s<t.length;++s){let a=t[s],l=Math.round(a.timestamp/h)*h/this.timePerPixel-this.camera.x;if(n.beginPath(),n.moveTo(l,-i-20),n.lineTo(l,i+20),n.lineWidth=1,n.strokeStyle="rgba(218, 218, 216, 0.3)",n.stroke(),e.exists(a.enemyInstanceID)){let t=this.report.enemies.get(a.enemyInstanceID);e.exists(t)&&this.GTFOEnemyIcons.has(t.type)&&n.drawImage(this.GTFOEnemyIcons.get(t.type),l-25,i+80,50,50)}else e.exists(a.playerID)&&e.exists(a.gearName)&&this.GTFOGearIcons.has(a.gearName)&&n.drawImage(this.GTFOGearIcons.get(a.gearName),l-25,i+80,50,50);if(t[s].timestamp>o)break}}{let e=this.player.packsTimeline,t=0;for(;t<e.length;++t)if(e[t].timestamp>m){t>0&&--t;break}for(;t<e.length;++t){let s=e[t],a=Math.round(s.timestamp/h)*h/this.timePerPixel-this.camera.x;if(n.beginPath(),n.moveTo(a,-i-20),n.lineTo(a,i+20),n.lineWidth=1,n.strokeStyle="rgba(233, 188, 41, 0.5)",n.stroke(),this.GTFOPackIcons.has(s.type)&&n.drawImage(this.GTFOPackIcons.get(s.type),a-25,-i-150,50,50),e[t].timestamp>o)break}}if(e.exists(this.selected)){let e=this.selected.start/this.timePerPixel-this.camera.x,t=this.selected.end/this.timePerPixel-this.camera.x;if(e>t){let i=e;e=t,t=i}n.fillStyle="rgba(218, 218, 216, 0.3)",n.fillRect(e,-i,t-e,2*i)}n.restore(),n.beginPath(),n.moveTo(this.mouse.x,-i-20),n.lineTo(this.mouse.x,i+20),n.lineWidth=1,n.strokeStyle="#dadad1",n.stroke(),n.font="20px Oxanium";let d=`${Math.round(p/this.player.healthMax*100)}`,y=n.measureText(d);n.fillStyle="#dadad1",n.fillText(d,this.mouse.x-y.width/2,-i-40);let u=(this.mouse.x+this.camera.x-s/2)*this.timePerPixel;if(u>0){n.font="20px Oxanium";let e=Math.floor(u/1e3),t=Math.floor(e/60),s=Math.floor(t/60),a=e-60*t,l=t-60*s;d=s>0?`${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${l.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`,y=n.measureText(d),n.fillStyle="#dadad1",n.fillText(d,this.mouse.x-y.width/2,i+60)}0!=c&&(n.font="20px Oxanium",d=`${Math.round(100*c)}`,y=n.measureText(d),n.fillStyle="green",n.fillText(d,this.mouse.x-y.width/2,-i-60))}if(e.exists(this.selected)&&e.exists(this.player)){let e=[],t=this.player.timeline,i=this.selected.start,s=this.selected.end,a=0,n=!1;if(i>s){let e=i;i=s,s=e}let l=0;for(;l<t.length&&!(t[l].event.timestamp>i);++l);for(;l<t.length&&!(t[l].event.timestamp>s);++l)e.push(t[l]),t[l]!==this.selectedEvents[a++]&&(n=!0);(n||e.length!==this.selectedEvents.length)&&(this.selectedEvents=e,this.updateSnapshot(this.selectedEvents))}else this.updateSnapshot()},i.prototype.updateSnapshot=function(t){if(this.snapshot.replaceChildren(),!e.exists(t))return;if(!e.exists(this.report))return;if(!e.exists(this.player))return;if(!e.exists(this.selected))return;let i=this.report,s=this.player,a=new DocumentFragment;{let n,l,r,h;const m=1e3;let o=()=>{n=document.createElement("li"),n.style.display="flex",n.style.gap="1rem",n.style.alignItems="center",l=document.createElement("span"),l.style.color="#c8ad62",r=0,h=void 0};o();let p=t=>{let p=t=>{let h=timeToString(t.timestamp);h!==l.innerHTML?l.innerHTML+=` - ${h}:`:l.innerHTML+=":";let m=document.createElement("img");if(m.style.width="4rem",e.exists(t.enemyInstanceID)){m.style.width="3rem";let s=i.enemies.get(t.enemyInstanceID);e.exists(s)&&(m.src=`./icons/enemies/${s.type}.png`)}else"PlayerBullet"!==t.type&&"PlayerExplosive"!==t.type||(m.src=`./icons/gear/${t.gearName}.webp`);let p=document.createElement("span");if(p.innerHTML=`<span style="font-weight: 800;">${Math.round(r/s.healthMax*100)}</span> damage dealt by`,n.append(l,p,m),e.exists(t.enemyInstanceID)){let s=i.enemies.get(t.enemyInstanceID);if(e.exists(s)){let i=document.createElement("a");i.innerHTML=`${s.name} (${t.type})`,i.addEventListener("click",(()=>{mount.enemiesBtn.click(),requestAnimationFrame((()=>{e.exists(s)&&mount.navbar[1].panel.list.goTo(s.name)}))})),n.append(i)}}else{let s=i.allPlayers.get(t.playerID);if(e.exists(s)){let e=document.createElement("span");e.innerHTML=s.name,e.style.color="#e9bc29",n.append(e)}}a.append(n),o()};if(e.exists(h))if(e.exists(t))switch(t.type){case"packs":case"state":if("damage"===h.type)p(h.event);break;case"damage":{let i=t.event,s=h.event;if("FallDamage"===i.type)p(s);else if("damage"===h.type)i.type!==s.type||i.timestamp-s.timestamp>m?p(s):e.exists(i.enemyInstanceID)?i.enemyInstanceID!==s.enemyInstanceID&&p(s):i.gearName===s.gearName&&i.playerID===s.playerID||p(s)}}else if("damage"===h.type)p(h.event)};for(let m=0;m<t.length;++m){let c=!1,d=t[m];switch(p(d),d.type){case"packs":{let t=d.event;l.innerHTML=`${timeToString(t.timestamp)}:`;let r=document.createElement("img");r.style.width="4rem",r.src=`./icons/packs/${t.type}.webp`;let h=document.createElement("span"),m="";if(e.exists(t.playerID)&&t.playerID!==s.playerID){let s=i.allPlayers.get(t.playerID);e.exists(s)&&(m+=`given by <span>${s.name}</span>`)}else m="consumed";h.innerHTML=m,n.append(l,r,h),a.append(n),c=!0}break;case"state":{let t=d.event;l.innerHTML=`${timeToString(t.timestamp)}:`;let r=document.createElement("span");switch(t.type){case"Down":r.innerHTML=`<span style="color: #e9bc29;">${s.name}</span> was <span>downed</span>`;break;case"Revive":if(e.exists(t.playerID)){let a=i.allPlayers.get(t.playerID);e.exists(a)&&(r.innerHTML=`<span style="color: #e9bc29;">${s.name}</span> was <span>revived</span> by <span style="color: #e9bc29;">${a.name}</span>`)}break;case"Checkpoint":r.innerHTML='<span style="color: rgb(80, 212, 120);">Checkpoint reloaded</span>'}n.append(l,r),a.append(n),c=!0}break;case"damage":{let t=d.event;e.exists(h)||(l.innerHTML=`${timeToString(t.timestamp)}`),r+=t.damage,"FallDamage"===t.type&&(n.append(l,document.createTextNode(`${Math.round(r/s.healthMax*100)} fall damage taken`)),a.append(n),o())}}h=d,c&&o()}p()}this.snapshot.append(a)},i.prototype.load=function(e,t){this.report=t,this.player=e,this.GTFOEnemyIcons.clear();for(let e in t.spec.enemies){let i=t.spec.enemies[e];if(!this.GTFOEnemyIcons.has(i.type)){let e=new Image;this.GTFOEnemyIcons.set(i.type,e),e.src=`./icons/enemies/${i.type}.png`}}this.GTFOGearIcons.clear();for(let e in t.spec.gear){let i=t.spec.gear[e];if(!this.GTFOGearIcons.has(i.publicName)){let e=new Image;this.GTFOGearIcons.set(i.publicName,e),e.src=`./icons/gear/${i.publicName}.webp`}}this.GTFOPackIcons.clear();for(let e in t.spec.packs){let i=t.spec.packs[e];if(!this.GTFOPackIcons.has(i)){let e=new Image;this.GTFOPackIcons.set(i,e),e.src=`./icons/packs/${i}.webp`}}this.render()},e.Macro(i,"graph",'\n            <canvas rhu-id="timeline" style="width: 100%; height: 70vh;"></canvas>\n            <div class="margins">\n                <div class="margins-wrapper">\n                    <ul rhu-id="snapshot" style="display: flex; flex-direction:column; gap: 1rem;">\n                    </ul>\n                </div>\n            </div>\n            ',{element:"<div></div>"})}}));
//# sourceMappingURL=main.bfd6dab5.js.map
